<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>korma.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Korma 0.5.0-RC1 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>korma</span></div></div></li><li class="depth-2 branch current"><a href="korma.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><a href="korma.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="korma.core.html#var-*exec-mode*"><div class="inner"><span>*exec-mode*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-add-comment"><div class="inner"><span>add-comment</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-add-joins"><div class="inner"><span>add-joins</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-aggregate"><div class="inner"><span>aggregate</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-as-sql"><div class="inner"><span>as-sql</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-assoc-db-to-entity"><div class="inner"><span>assoc-db-to-entity</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-belongs-to"><div class="inner"><span>belongs-to</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-create-entity"><div class="inner"><span>create-entity</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-create-relation"><div class="inner"><span>create-relation</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-database"><div class="inner"><span>database</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-defentity"><div class="inner"><span>defentity</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-delete"><div class="inner"><span>delete</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-delete*"><div class="inner"><span>delete*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-dry-run"><div class="inner"><span>dry-run</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-empty-query"><div class="inner"><span>empty-query</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-entity-fields"><div class="inner"><span>entity-fields</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-entity.3F"><div class="inner"><span>entity?</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-exec"><div class="inner"><span>exec</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-exec-raw"><div class="inner"><span>exec-raw</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-fields"><div class="inner"><span>fields</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-fk"><div class="inner"><span>fk</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-from"><div class="inner"><span>from</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-get-rel"><div class="inner"><span>get-rel</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-group"><div class="inner"><span>group</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-has-many"><div class="inner"><span>has-many</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-has-one"><div class="inner"><span>has-one</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-having"><div class="inner"><span>having</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-having*"><div class="inner"><span>having*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-insert"><div class="inner"><span>insert</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-insert*"><div class="inner"><span>insert*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-intersect"><div class="inner"><span>intersect</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-intersect*"><div class="inner"><span>intersect*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-join"><div class="inner"><span>join</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-join*"><div class="inner"><span>join*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-lfk"><div class="inner"><span>lfk</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-limit"><div class="inner"><span>limit</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-many-to-many"><div class="inner"><span>many-to-many</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-many-to-many-fn"><div class="inner"><span>many-to-many-fn</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-modifier"><div class="inner"><span>modifier</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-offset"><div class="inner"><span>offset</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-order"><div class="inner"><span>order</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-pk"><div class="inner"><span>pk</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-post-query"><div class="inner"><span>post-query</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-prepare"><div class="inner"><span>prepare</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-queries"><div class="inner"><span>queries</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-query-only"><div class="inner"><span>query-only</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-raw"><div class="inner"><span>raw</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-rel"><div class="inner"><span>rel</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-rfk"><div class="inner"><span>rfk</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-select"><div class="inner"><span>select</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-select*"><div class="inner"><span>select*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-set-fields"><div class="inner"><span>set-fields</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-sql-only"><div class="inner"><span>sql-only</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-sqlfn"><div class="inner"><span>sqlfn</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-sqlfn*"><div class="inner"><span>sqlfn*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-subselect"><div class="inner"><span>subselect</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-table"><div class="inner"><span>table</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-transform"><div class="inner"><span>transform</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-union"><div class="inner"><span>union</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-union*"><div class="inner"><span>union*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-union-all"><div class="inner"><span>union-all</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-union-all*"><div class="inner"><span>union-all*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-update"><div class="inner"><span>update</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-update*"><div class="inner"><span>update*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-values"><div class="inner"><span>values</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-where"><div class="inner"><span>where</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-where*"><div class="inner"><span>where*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-with"><div class="inner"><span>with</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-with*"><div class="inner"><span>with*</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-with-batch"><div class="inner"><span>with-batch</span></div></a></li><li class="depth-1"><a href="korma.core.html#var-with-batch*"><div class="inner"><span>with-batch*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">korma.core</h2><div class="doc"><pre class="plaintext">Core querying and entity functions
</pre></div><div class="public anchor" id="var-*exec-mode*"><h3>*exec-mode*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L12">view source</a></div></div><div class="public anchor" id="var-add-comment"><h3>add-comment</h3><div class="usage"><code>(add-comment query comment-str)</code></div><div class="doc"><pre class="plaintext">Add a comment clause to a select query
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L365">view source</a></div></div><div class="public anchor" id="var-add-joins"><h3>add-joins</h3><div class="usage"><code>(add-joins query ent rel)</code><code>(add-joins query ent rel type)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L300">view source</a></div></div><div class="public anchor" id="var-aggregate"><h3>aggregate</h3><h4 class="type">macro</h4><div class="usage"><code>(aggregate query agg alias &amp; [group-by])</code></div><div class="doc"><pre class="plaintext">Use a SQL aggregator function, aliasing the results, and optionally grouping by
a field:

(select users
  (aggregate (count :*) :cnt :status))

Aggregates available: count, sum, avg, min, max, first, last</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L370">view source</a></div></div><div class="public anchor" id="var-as-sql"><h3>as-sql</h3><div class="usage"><code>(as-sql query)</code></div><div class="doc"><pre class="plaintext">Force a query to return a string of SQL when (exec) is called.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L458">view source</a></div></div><div class="public anchor" id="var-assoc-db-to-entity"><h3>assoc-db-to-entity</h3><div class="usage"><code>(assoc-db-to-entity query ent)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L768">view source</a></div></div><div class="public anchor" id="var-belongs-to"><h3>belongs-to</h3><h4 class="type">macro</h4><div class="usage"><code>(belongs-to ent sub-ent)</code><code>(belongs-to ent sub-ent opts)</code></div><div class="doc"><pre class="plaintext">Add a belongs-to relationship for the given entity. It is assumed that the foreign key
is on the current entity with the format sub-ent-table_id: email.user_id = user.id.
Can optionally pass a map with a :fk key collection or use the helper `fk` function
to explicitly set the foreign key.

(belongs-to users email)
(belongs-to users email (fk :userId))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L625">view source</a></div></div><div class="public anchor" id="var-create-entity"><h3>create-entity</h3><div class="usage"><code>(create-entity table)</code></div><div class="doc"><pre class="plaintext">Create an entity representing a table in a database.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L539">view source</a></div></div><div class="public anchor" id="var-create-relation"><h3>create-relation</h3><div class="usage"><code>(create-relation ent sub-ent type opts)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L584">view source</a></div></div><div class="public anchor" id="var-database"><h3>database</h3><div class="usage"><code>(database ent db)</code></div><div class="doc"><pre class="plaintext">Set the database connection to be used for this entity.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L718">view source</a></div></div><div class="public anchor" id="var-defentity"><h3>defentity</h3><h4 class="type">macro</h4><div class="usage"><code>(defentity ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Define an entity representing a table in the database, applying any modifications in
the body.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L733">view source</a></div></div><div class="public anchor" id="var-delete"><h3>delete</h3><h4 class="type">macro</h4><div class="usage"><code>(delete ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates a delete query, applies any modifying functions in the body and then
executes it. `ent` is either a string or an entity created by defentity.
Returns number of deleted rows as provided by the JDBC driver.

ex: (delete user
      (where {:id 7}))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L134">view source</a></div></div><div class="public anchor" id="var-delete*"><h3>delete*</h3><div class="usage"><code>(delete* ent)</code></div><div class="doc"><pre class="plaintext">Create an empty delete query. Ent can either be an entity defined by defentity,
or a string of the table name</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L64">view source</a></div></div><div class="public anchor" id="var-dry-run"><h3>dry-run</h3><h4 class="type">macro</h4><div class="usage"><code>(dry-run &amp; body)</code></div><div class="doc"><pre class="plaintext">Wrap around a set of queries to print to the console all SQL that would
be run and return dummy values instead of executing them.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L445">view source</a></div></div><div class="public anchor" id="var-empty-query"><h3>empty-query</h3><div class="usage"><code>(empty-query ent)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L19">view source</a></div></div><div class="public anchor" id="var-entity-fields"><h3>entity-fields</h3><div class="usage"><code>(entity-fields ent &amp; fields)</code></div><div class="doc"><pre class="plaintext">Set the fields to be retrieved in all select queries for the
entity.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L677">view source</a></div></div><div class="public anchor" id="var-entity.3F"><h3>entity?</h3><div class="usage"><code>(entity? x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L537">view source</a></div></div><div class="public anchor" id="var-exec"><h3>exec</h3><div class="usage"><code>(exec query)</code></div><div class="doc"><pre class="plaintext">Execute a query map and return the results.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L491">view source</a></div></div><div class="public anchor" id="var-exec-raw"><h3>exec-raw</h3><div class="usage"><code>(exec-raw conn? &amp; [sql with-results?])</code></div><div class="doc"><pre class="plaintext">Execute a raw SQL string, supplying whether results should be returned. `sql`
can either be a string or a vector of the sql string and its params. You can
also optionally provide the connection to execute against as the first
parameter.

(exec-raw [&quot;SELECT * FROM users WHERE age &gt; ?&quot; [5]] :results)</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L518">view source</a></div></div><div class="public anchor" id="var-fields"><h3>fields</h3><div class="usage"><code>(fields query &amp; vs)</code></div><div class="doc"><pre class="plaintext">Set the fields to be selected in a query. Fields can either be a keyword
or a vector of two keywords [field alias]:

(fields query :name [:firstname :first])</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L207">view source</a></div></div><div class="public anchor" id="var-fk"><h3>fk</h3><div class="usage"><code>(fk &amp; fk)</code></div><div class="doc"><pre class="plaintext">Set the foreign key used for an entity relationship.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L703">view source</a></div></div><div class="public anchor" id="var-from"><h3>from</h3><div class="usage"><code>(from query table)</code></div><div class="doc"><pre class="plaintext">Add tables to the from clause.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L223">view source</a></div></div><div class="public anchor" id="var-get-rel"><h3>get-rel</h3><div class="usage"><code>(get-rel ent sub-ent)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L606">view source</a></div></div><div class="public anchor" id="var-group"><h3>group</h3><div class="usage"><code>(group query &amp; fields)</code></div><div class="doc"><pre class="plaintext">Add a group-by clause to a select query
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L360">view source</a></div></div><div class="public anchor" id="var-has-many"><h3>has-many</h3><h4 class="type">macro</h4><div class="usage"><code>(has-many ent sub-ent)</code><code>(has-many ent sub-ent opts)</code></div><div class="doc"><pre class="plaintext">Add a has-many relation for the given entity. It is assumed that the foreign key
is on the sub-entity with the format table_id: user.id = email.user_id
Can optionally pass a map with a :fk key collection or use the helper `fk` function
to explicitly set the foreign key.

(has-many users email)
(has-many users email (fk :emailID))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L638">view source</a></div></div><div class="public anchor" id="var-has-one"><h3>has-one</h3><h4 class="type">macro</h4><div class="usage"><code>(has-one ent sub-ent)</code><code>(has-one ent sub-ent opts)</code></div><div class="doc"><pre class="plaintext">Add a has-one relationship for the given entity. It is assumed that the foreign key
is on the sub-entity with the format table_id: user.id = address.user_id
Can optionally pass a map with a :fk key collection or use the helper `fk` function
to explicitly set the foreign key.

(has-one users address)
(has-one users address (fk :userId))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L612">view source</a></div></div><div class="public anchor" id="var-having"><h3>having</h3><h4 class="type">macro</h4><div class="usage"><code>(having query form)</code></div><div class="doc"><pre class="plaintext">Add a having clause to the query, expressing the clause in clojure expressions
with keywords used to reference fields.
e.g. (having query (or (= :hits 1) (&gt; :hits 5)))

Available predicates: and, or, =, not=, &lt;, &gt;, &lt;=, &gt;=, in, like, not, between

Having can also take a map at any point and will create a clause that compares
keys to values. The value can be a vector with one of the above predicate
functions describing how the key is related to the value:
  (having query {:name [like &quot;chris&quot;})

Having only works if you have an aggregation, using it without one will cause
an error.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L260">view source</a></div></div><div class="public anchor" id="var-having*"><h3>having*</h3><div class="usage"><code>(having* query clause)</code></div><div class="doc"><pre class="plaintext">Add a having clause to the query. Clause can be either a map or a string, and
will be AND&apos;ed to the other clauses.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L254">view source</a></div></div><div class="public anchor" id="var-insert"><h3>insert</h3><h4 class="type">macro</h4><div class="usage"><code>(insert ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates an insert query, applies any modifying functions in the body
and then executes it. `ent` is either a string or an entity created by
defentity. The return value is the last inserted item, but its
representation is dependent on the database driver used
(e.g. postgresql returns the full row as a hash,
MySQL returns a {:generated_key &lt;ID&gt;} hash,
and MSSQL returns a {:generated_keys &lt;ID&gt;} hash).

ex: (insert user
      (values [{:name &quot;chris&quot;} {:name &quot;john&quot;}]))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L144">view source</a></div></div><div class="public anchor" id="var-insert*"><h3>insert*</h3><div class="usage"><code>(insert* ent)</code></div><div class="doc"><pre class="plaintext">Create an empty insert query. Ent can either be an entity defined by defentity,
or a string of the table name</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L72">view source</a></div></div><div class="public anchor" id="var-intersect"><h3>intersect</h3><h4 class="type">macro</h4><div class="usage"><code>(intersect &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates an intersect query, applies any modifying functions in the body and then
executes it.

ex: (intersect
      (queries (subselect user
                 (where {:id 7}))
               (subselect user-backup
                 (where {:id 8})))
      (order :name))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L184">view source</a></div></div><div class="public anchor" id="var-intersect*"><h3>intersect*</h3><div class="usage"><code>(intersect*)</code></div><div class="doc"><pre class="plaintext">Create an empty intersect query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L96">view source</a></div></div><div class="public anchor" id="var-join"><h3>join</h3><h4 class="type">macro</h4><div class="usage"><code>(join query ent)</code><code>(join query type-or-table ent-or-clause)</code><code>(join query type table clause)</code></div><div class="doc"><pre class="plaintext">Add a join clause to a select query, specifying an entity defined by defentity, or the table name to
join and the predicate to join on. If the entity relationship uses a join
table then two clauses will be added. Otherwise, only one clause
will be added.

(join query addresses)
(join query :right addresses)
(join query addresses (= :addres.users_id :users.id))
(join query :right addresses (= :address.users_id :users.id))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L320">view source</a></div></div><div class="public anchor" id="var-join*"><h3>join*</h3><div class="usage"><code>(join* query type table clause)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L297">view source</a></div></div><div class="public anchor" id="var-lfk"><h3>lfk</h3><div class="usage"><code>(lfk &amp; lfk)</code></div><div class="doc"><pre class="plaintext">Set the left foreign key used for an entity relationship.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L708">view source</a></div></div><div class="public anchor" id="var-limit"><h3>limit</h3><div class="usage"><code>(limit query v)</code></div><div class="doc"><pre class="plaintext">Add a limit clause to a select query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L350">view source</a></div></div><div class="public anchor" id="var-many-to-many"><h3>many-to-many</h3><h4 class="type">macro</h4><div class="usage"><code>(many-to-many ent sub-ent join-table)</code><code>(many-to-many ent sub-ent join-table fk1 fk2)</code><code>(many-to-many ent sub-ent join-table opts)</code></div><div class="doc"><pre class="plaintext">Add a many-to-many relation for the given entity.  It is assumed that a join
table is used to implement the relationship and that the foreign keys are in
the join table with the format table_id:
  user.id = user_email.user_id
  user_email.email_id = email.id
Can optionally pass a map with :lfk and :rfk key collections or use the
helper `lfk`, `rfk` functions to explicitly set the join keys.

(many-to-many email :user_email)
(many-to-many email :user_email (lfk :user_id)
                                (rfk :email_id))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L658">view source</a></div></div><div class="public anchor" id="var-many-to-many-fn"><h3>many-to-many-fn</h3><div class="usage"><code>(many-to-many-fn ent sub-ent-var join-table opts)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L651">view source</a></div></div><div class="public anchor" id="var-modifier"><h3>modifier</h3><div class="usage"><code>(modifier query &amp; modifiers)</code></div><div class="doc"><pre class="plaintext">Add a modifer to the beginning of a query:

(select orders
  (modifier &quot;DISTINCT&quot;))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L417">view source</a></div></div><div class="public anchor" id="var-offset"><h3>offset</h3><div class="usage"><code>(offset query v)</code></div><div class="doc"><pre class="plaintext">Add an offset clause to a select query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L355">view source</a></div></div><div class="public anchor" id="var-order"><h3>order</h3><div class="usage"><code>(order query field dir)</code><code>(order query field)</code></div><div class="doc"><pre class="plaintext">Add an ORDER BY clause to a select, union, union-all, or intersect query.
field should be a keyword of the field name, dir is ASC by default.

(order query :created :asc)</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L277">view source</a></div></div><div class="public anchor" id="var-pk"><h3>pk</h3><div class="usage"><code>(pk ent &amp; pk)</code></div><div class="doc"><pre class="plaintext">Set the primary key used for an entity. :id by default.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L698">view source</a></div></div><div class="public anchor" id="var-post-query"><h3>post-query</h3><div class="usage"><code>(post-query query post)</code></div><div class="doc"><pre class="plaintext">Add a function representing a query that should be executed for each result
in a select. This is done lazily over the result set.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L344">view source</a></div></div><div class="public anchor" id="var-prepare"><h3>prepare</h3><div class="usage"><code>(prepare ent func)</code></div><div class="doc"><pre class="plaintext">Add a function to be applied to records/values going into the database
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L728">view source</a></div></div><div class="public anchor" id="var-queries"><h3>queries</h3><div class="usage"><code>(queries query &amp; queries)</code></div><div class="doc"><pre class="plaintext">Adds a group of queries to a union, union-all or intersect
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L386">view source</a></div></div><div class="public anchor" id="var-query-only"><h3>query-only</h3><h4 class="type">macro</h4><div class="usage"><code>(query-only &amp; body)</code></div><div class="doc"><pre class="plaintext">Wrap around a set of queries to force them to return their query objects.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L452">view source</a></div></div><div class="public anchor" id="var-raw"><h3>raw</h3><div class="usage"><code>(raw s)</code></div><div class="doc"><pre class="plaintext">Embed a raw string of SQL in a query. This is used when Korma doesn&apos;t
provide some specific functionality you&apos;re looking for:

(select users
  (fields (raw &quot;PERIOD(NOW(), NOW())&quot;)))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L425">view source</a></div></div><div class="public anchor" id="var-rel"><h3>rel</h3><div class="usage"><code>(rel ent sub-ent type opts)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L595">view source</a></div></div><div class="public anchor" id="var-rfk"><h3>rfk</h3><div class="usage"><code>(rfk &amp; rfk)</code></div><div class="doc"><pre class="plaintext">Set the right foreign key used for an entity relationship.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L713">view source</a></div></div><div class="public anchor" id="var-select"><h3>select</h3><h4 class="type">macro</h4><div class="usage"><code>(select ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates a select query, applies any modifying functions in the body and then
executes it. `ent` is either a string or an entity created by defentity.

ex: (select user
      (fields :name :email)
      (where {:id 2}))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L113">view source</a></div></div><div class="public anchor" id="var-select*"><h3>select*</h3><div class="usage"><code>(select* ent)</code></div><div class="doc"><pre class="plaintext">Create a select query with fields provided in Ent.  If fields are not provided,
create an empty select query. Ent can either be an entity defined by defentity,
or a string of the table name</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L38">view source</a></div></div><div class="public anchor" id="var-set-fields"><h3>set-fields</h3><div class="usage"><code>(set-fields query fields-map)</code></div><div class="doc"><pre class="plaintext">Set the fields and values for an update query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L218">view source</a></div></div><div class="public anchor" id="var-sql-only"><h3>sql-only</h3><h4 class="type">macro</h4><div class="usage"><code>(sql-only &amp; body)</code></div><div class="doc"><pre class="plaintext">Wrap around a set of queries so that instead of executing, each will return a
string of the SQL that would be used.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L438">view source</a></div></div><div class="public anchor" id="var-sqlfn"><h3>sqlfn</h3><h4 class="type">macro</h4><div class="usage"><code>(sqlfn func &amp; params)</code></div><div class="doc"><pre class="plaintext">Call an arbitrary SQL function by providing func as a symbol or keyword
and its params</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L401">view source</a></div></div><div class="public anchor" id="var-sqlfn*"><h3>sqlfn*</h3><div class="usage"><code>(sqlfn* fn-name &amp; params)</code></div><div class="doc"><pre class="plaintext">Call an arbitrary SQL function by providing the name of the function
and its params</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L395">view source</a></div></div><div class="public anchor" id="var-subselect"><h3>subselect</h3><h4 class="type">macro</h4><div class="usage"><code>(subselect &amp; parts)</code></div><div class="doc"><pre class="plaintext">Create a subselect clause to be used in queries. This works exactly like
(select ...) execept it will wrap the query in ( .. ) and make sure it can be
used in any current query:

(select users
  (where {:id [in (subselect users2 (fields :id))]}))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L407">view source</a></div></div><div class="public anchor" id="var-table"><h3>table</h3><div class="usage"><code>(table ent t &amp; [alias])</code></div><div class="doc"><pre class="plaintext">Set the name of the table and an optional alias to be used for the entity.
By default the table is the name of entity&apos;s symbol.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L683">view source</a></div></div><div class="public anchor" id="var-transform"><h3>transform</h3><div class="usage"><code>(transform ent func)</code></div><div class="doc"><pre class="plaintext">Add a function to be applied to results coming from the database
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L723">view source</a></div></div><div class="public anchor" id="var-union"><h3>union</h3><h4 class="type">macro</h4><div class="usage"><code>(union &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates a union query, applies any modifying functions in the body and then
executes it.

ex: (union
      (queries (subselect user
                 (where {:id 7}))
               (subselect user-backup
                 (where {:id 7})))
      (order :name))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L158">view source</a></div></div><div class="public anchor" id="var-union*"><h3>union*</h3><div class="usage"><code>(union*)</code></div><div class="doc"><pre class="plaintext">Create an empty union query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L80">view source</a></div></div><div class="public anchor" id="var-union-all"><h3>union-all</h3><h4 class="type">macro</h4><div class="usage"><code>(union-all &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates a union-all query, applies any modifying functions in the body and then
executes it.

ex: (union-all
      (queries (subselect user
                 (where {:id 7}))
               (subselect user-backup
                 (where {:id 7})))
      (order :name))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L171">view source</a></div></div><div class="public anchor" id="var-union-all*"><h3>union-all*</h3><div class="usage"><code>(union-all*)</code></div><div class="doc"><pre class="plaintext">Create an empty union-all query.
</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L88">view source</a></div></div><div class="public anchor" id="var-update"><h3>update</h3><h4 class="type">macro</h4><div class="usage"><code>(update ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Creates an update query, applies any modifying functions in the body and then
executes it. `ent` is either a string or an entity created by defentity.
Returns number of updated rows as provided by the JDBC driver.

ex: (update user
      (set-fields {:name &quot;chris&quot;})
      (where {:id 4}))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L123">view source</a></div></div><div class="public anchor" id="var-update*"><h3>update*</h3><div class="usage"><code>(update* ent)</code></div><div class="doc"><pre class="plaintext">Create an empty update query. Ent can either be an entity defined by defentity,
or a string of the table name.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L55">view source</a></div></div><div class="public anchor" id="var-values"><h3>values</h3><div class="usage"><code>(values query values)</code></div><div class="doc"><pre class="plaintext">Add records to an insert clause. values can either be a vector of maps or a
single map.

(values query [{:name &quot;john&quot;} {:name &quot;ed&quot;}])</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L287">view source</a></div></div><div class="public anchor" id="var-where"><h3>where</h3><h4 class="type">macro</h4><div class="usage"><code>(where query form)</code></div><div class="doc"><pre class="plaintext">Add a where clause to the query, expressing the clause in clojure expressions
with keywords used to reference fields.
e.g. (where query (or (= :hits 1) (&gt; :hits 5)))

Available predicates: and, or, =, not=, &lt;, &gt;, &lt;=, &gt;=, in, like, not, between

Where can also take a map at any point and will create a clause that compares keys
to values. The value can be a vector with one of the above predicate functions
describing how the key is related to the value:
  (where query {:name [like &quot;chris&quot;]})</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L240">view source</a></div></div><div class="public anchor" id="var-where*"><h3>where*</h3><div class="usage"><code>(where* query clause)</code></div><div class="doc"><pre class="plaintext">Add a where clause to the query. Clause can be either a map or a string, and
will be AND&apos;ed to the other clauses.</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L234">view source</a></div></div><div class="public anchor" id="var-with"><h3>with</h3><h4 class="type">macro</h4><div class="usage"><code>(with query ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Add a related entity to the given select query. If the entity has a relationship
type of :belongs-to or :has-one, the requested fields will be returned directly in
the result map. If the entity is a :has-many, a second query will be executed lazily
and a key of the entity name will be assoc&apos;d with a vector of the results.

(defentity email (entity-fields :email))
(defentity user (has-many email))
(select user
  (with email) =&gt; [{:name &quot;chris&quot; :email [{email: &quot;c@c.com&quot;}]} ...

With can also take a body that will further refine the relation:
(select user
   (with address
      (with state)
      (fields :address.city :state.state)
      (where {:address.zip x})))</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L864">view source</a></div></div><div class="public anchor" id="var-with*"><h3>with*</h3><div class="usage"><code>(with* query sub-ent body-fn)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L852">view source</a></div></div><div class="public anchor" id="var-with-batch"><h3>with-batch</h3><h4 class="type">macro</h4><div class="usage"><code>(with-batch query ent &amp; body)</code></div><div class="doc"><pre class="plaintext">Add a related entity. This behaves like `with`, except that, for has-many
relationships, it runs a single query to get relations of all fetched rows.
This is faster than regular `with` but it doesn&apos;t support many of the
additional options (order, limit, offset, group, having)</pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L942">view source</a></div></div><div class="public anchor" id="var-with-batch*"><h3>with-batch*</h3><div class="usage"><code>(with-batch* query sub-ent body-fn)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/korma/Korma/blob/master/src/korma/core.clj#L934">view source</a></div></div></div></body></html>